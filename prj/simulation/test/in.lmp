# Agent Based Simulation Of Biological Systems


#       --- SET UP OF INPUT VARIABLES ---

# duration : int = N number of steps for the current run
variable time_value index 50  # default value: 50 loop * 100 steps
variable loop_len equal ${time_value}

# atoms : int = N number of atoms of each type to generate 
# uncomment this lines and substitue the number of atoms
# in the create_atoms command with this variable 
# to modify the initial amount of atoms in the simulation;
# prj/run.sh -h for more info
# Note: doing so the initial amount will be the same for all atoms types
#variable num_atoms index 5
#variable atoms equal ${num_atoms}


#       --- SIMULATION BOX PROPERTIES ---

# sym measure units and atoms style
units       lj
atom_style  full 

# box dimension, boudaries and structure
dimension   3  
boundary    f f f 
lattice     fcc 3.52

# flag2 = on or off for bonded interactions
newton on off

# define simulation box
region      box block 0 30 0 30 0 30
create_box  20 box  bond/types 10 extra/bond/per/atom 100

# create simulation walls
fix xwalls all wall/reflect xlo EDGE xhi EDGE
fix ywalls all wall/reflect ylo EDGE yhi EDGE
fix zwalls all wall/reflect zlo EDGE zhi EDGE


#       --- AGENTS PROPRETIES AND FORCE FIELDS ---
# creation of atoms of types in randoms spots inside the box
create_atoms    1 random 5 5783 box  # s1     | reactant |
create_atoms    2 random 5 5784 box  # s2      | product  |
create_atoms    3 random 5 5785 box  # s3     | reactant |
create_atoms    4 random 5 5786 box  # s4      | product  |
create_atoms    5 random 5 5787 box  # s5     | reactant |
create_atoms    6 random 5 5788 box  # s6     | reactant |
create_atoms    7 random 5 5789 box  # s7      | product  |
create_atoms    8 random 5 5790 box  # s8     | reactant |
create_atoms    9 random 5 5791 box  # s9     | reactant |
create_atoms    10 random 5 5792 box  # s10     | reactant |
create_atoms    11 random 5 5793 box  # s11      | product  |
create_atoms    12 random 5 5794 box  # s12      | product  |
create_atoms    13 random 5 5795 box  # s13      | product  |
create_atoms    14 random 5 5796 box  # s14     | reactant |
create_atoms    15 random 5 5797 box  # s15      | product  |
create_atoms    16 random 5 5798 box  # s16      | product  |
create_atoms    17 random 5 5799 box  # s17     | reactant |
create_atoms    18 random 5 5800 box  # s18     | reactant |
create_atoms    19 random 5 5801 box  # s19      | product  |
create_atoms    20 random 5 5802 box  # s20      | product  |

# atoms mass
mass 1 1.0
mass 2 1.0
mass 3 1.0
mass 4 1.0
mass 5 1.0
mass 6 1.0
mass 7 1.0
mass 8 1.0
mass 9 1.0
mass 10 1.0
mass 11 1.0
mass 12 1.0
mass 13 1.0
mass 14 1.0
mass 15 1.0
mass 16 1.0
mass 17 1.0
mass 18 1.0
mass 19 1.0
mass 20 1.0

# assing atoms to agents groups
group agents3 type 3 
group agents4 type 5 6 
group agents5 type 8 9 10 
group agents7 type 14 
group agents8 type 17 18 
group mortals type 1 

# force fields style and coefficient
pair_style zero 5.0
pair_coeff * *

# bond style and coefficients
bond_style  harmonic
bond_coeff * 100 1.1

 
#      --- SIMULATION ---

# set time steps 
timestep 0.001   # seconds

# This command sets parameters that affect
# the building of pairwise neighbor lists
neighbor 0.001 bin
neigh_modify every 10 delay 100

# print thermodinamic inf every N timesteps
thermo 100 

# fix ID group-ID bond/create Nevery itype jtype Rmin bondtype keyword values
# this fix will attempt to create new bond btw atoms of type i and j every N timestep
fix bond1 all bond/create 10 5 6 1.0 1 prob 0.5 5803
fix bond2 all bond/create 10 8 9 1.0 2 prob 0.5 5804
fix bond3 all bond/create 10 8 10 1.0 3 prob 0.5 5805
fix bond4 all bond/create 10 9 10 1.0 4 prob 0.5 5806
fix bond5 all bond/create 10 17 18 1.0 5 prob 0.5 5807

# set velocity for all atoms
velocity all create 300.0 4928459 rot yes dist gaussian 

# perform plain time integration 
# to update position and velocity
# and simulate Brownioan motion
fix 1 all nve
fix 2 all langevin 300.0 300.0 10.0 904297

# compute if atoms has a bonds
# and total number of bonds btw all atoms
compute hb0 all property/atom nbonds 

compute hb3 agents3 property/atom nbonds
compute cb3 agents3 reduce sum c_hb3

compute hb4 agents4 property/atom nbonds
compute cb4 agents4 reduce sum c_hb4

compute hb5 agents5 property/atom nbonds
compute cb5 agents5 reduce sum c_hb5

compute hb7 agents7 property/atom nbonds
compute cb7 agents7 reduce sum c_hb7

compute hb8 agents8 property/atom nbonds
compute cb8 agents8 reduce sum c_hb8


# this lines are necessary to insure that the “hasbond” and 'newatoms' 
# variables are current when the group command invokes it.
thermo_style custom step temp pe c_cb3 c_cb4 c_cb5 c_cb7 c_cb8 
run 0

# hasbond : boolean = true if atom I has a bond with atom J
variable hasbond atom 'c_hb0 > 0.0'


# counter : int = N total number of bonds in the sim
variable counter3 equal ceil(c_cb3)
variable counter4 equal ceil(c_cb4)
variable counter5 equal ceil(c_cb5)
variable counter7 equal ceil(c_cb7)
variable counter8 equal ceil(c_cb8)

# print themo info every timestep
thermo_style custom step temp pe v_counter3 v_counter4 v_counter5 v_counter7 v_counter8 

# dumps atoms information
dump 1 all custom 10 dump.test.out id x y z type 


#       --- LOOP---

label loop
variable step loop ${loop_len}   # loop length

# create new atoms only if new bonds have been made
# the num of new atoms is linked to the number of new bonds as follow:
# fix ID group-ID deposit N type M seed keyword values
fix deposit2 all deposit 1 2 1 5748 region box near 2.0
variable newatoms3 equal floor(${counter3}/2)
if '${counter3} > 0' then &
'fix deposit4 all deposit ${newatoms3} 4 1 5748 region box near 2.0' 
variable newatoms4 equal floor(${counter4}/2)
if '${counter4} > 0' then &
'fix deposit7 all deposit ${newatoms4} 7 1 5748 region box near 2.0' 
variable newatoms5 equal floor(${counter5}/2)
if '${counter5} > 0' then &
'fix deposit11 all deposit ${newatoms5} 11 1 5748 region box near 2.0' 
fix deposit6 all deposit 1 12 1 5748 region box near 2.0
fix deposit6 all deposit 1 13 1 5748 region box near 2.0
variable newatoms7 equal floor(${counter7}/2)
if '${counter7} > 0' then &
'fix deposit15 all deposit ${newatoms7} 15 1 5748 region box near 2.0' &
'fix deposit16 all deposit ${newatoms7} 16 1 5748 region box near 2.0' 
variable newatoms8 equal floor(${counter8}/2)
if '${counter8} > 0' then &
'fix deposit19 all deposit ${newatoms8} 19 1 5748 region box near 2.0' &
'fix deposit20 all deposit ${newatoms8} 20 1 5748 region box near 2.0' 

# assing all atoms that have a bond to the garbage group
group garbage dynamic all every 1 var hasbond

# append new values on dump file
dump_modify 1 append yes

# perform n steps in loop
run 100

# delate all atoms in garbage
delete_atoms group garbage bond yes mol yes compress no

# delate some atoms in mortals every N timestamps 
# fix ID group-ID evaporate N M region-ID seed 
fix death mortals evaporate 100 1 box 5808

# jump to loop lable until step > 0 
next step
jump SELF loop

# end of loop
label break

# check on input variables
variable duration equal ${loop_len}*100
print ''
print 'Starting Atoms: 100 ' 
print 'Duration: ${duration}'
print 'ALL DONE' 

